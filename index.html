<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <script src="./scripts/vendor/nexusUI.js"></script>  
  <title>Gyro Synth</title>
</head>
<body>
  <canvas id="tilt" nx="tilt" width="300px"></canvas>
  <canvas id="startBtn" nx="button"></canvas>

  <script>

  var audio_context = window.AudioContext || window.webkitAudioContext;
  var con = new audio_context();

  var osc = con.createOscillator();
  var lfo = con.createOscillator();

  var lfo_amp = con.createGain();
  lfo_amp.gain.value = 200;

  //osc.frequency.value = 300;
  //lfo.frequency.value = 15;

  lfo.connect(lfo_amp);
  lfo_amp.connect(osc.frequency);
  osc.connect(con.destination);

   var tilt;
    nx.onload = function(){
        tilt.on('*', tiltChanged);
        startBtn.on('*', startTheSound);
    };

    function startTheSound(data){
      if(data.press == 1) {
        osc.start();
        lfo.start();
      } else {
        osc.stop();
        lfo.stop();
      }
        

    }

    function tiltChanged(data){
        osc.frequency.value = Math.abs(data.x) * 10;
        lfo.frequency.value = Math.abs(data.y) * 10;
    }
  </script>
</body>
</html>